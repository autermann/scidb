<?xml version="1.0" encoding="UTF-8"?>
<!-- This document was created with Syntext Serna Free. -->
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"docbookV4.5/docbookx.dtd">
<chapter>
  <title>SciDB Installation and Administration</title>

  <para><indexterm>
      <primary>platforms</primary>
    </indexterm><indexterm>
      <primary>SciDB</primary>

      <secondary>platforms</secondary>
    </indexterm>SciDB is supported on the following platforms:</para>

  <itemizedlist>
    <listitem>
      <para>Ubuntu 12.04</para>
    </listitem>

    <listitem>
      <para>CentOS 6.3</para>
    </listitem>

    <listitem>
      <para>Red Hat Enterprise Linux (RHEL) 6.3</para>
    </listitem>
  </itemizedlist>

  <note>
    <para>SciDB requires a 64-bit (x86_64 or amd64) platform.</para>
  </note>

  <para>A complete SciDB installation is a multi-database environment that
  includes the core SciDB engine, Postgres, the open source SQL database
  engine which is used for system catalog data, as well as ScaLAPACK/MPI which
  is used as a computational engine for dense linear algebra.</para>

  <para><indexterm>
      <primary>SciDB</primary>

      <secondary>contact</secondary>
    </indexterm><indexterm>
      <primary>support</primary>
    </indexterm>To report issues, contact
  <email>support@scidb.org</email>.</para>

  <section xml:id="InstallingSciDB">
    <title>Terminology</title>

    <para>The following terms are used to describe the SciDB installation and
    administration process:</para>

    <variablelist>
      <?dbfo term-width="1.5in"?>

      <varlistentry>
        <term>Single server</term>

        <listitem>
          <para><indexterm>
              <primary>server</primary>

              <secondary>single</secondary>
            </indexterm>A configuration that consists of a single machine with
          a processor that may contain multiple cores, memory and attached
          storage. A single server may be virtual or physical.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>Virtual server</term>

        <listitem>
          <para><indexterm>
              <primary>server</primary>

              <secondary>virtual</secondary>
            </indexterm>A server that shares hardware rather than having
          dedicated hardware.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>Coordinator server</term>

        <listitem>
          <para><indexterm>
              <primary>coordinator server</primary>
            </indexterm>In a configuration that has multiple servers, exactly
          one server functions as the coordinator, and contains the
          <emphasis>coordinator instance</emphasis>.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>SciDB instance</term>

        <listitem>
          <para>An independent SciDB group of processes, that is, a single
          running SciDB. There may be a many-to-one mapping between SciDB
          instances and a server.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>Coordinator instance</term>

        <listitem>
          <para><indexterm>
              <primary>instances</primary>

              <secondary>coordinator</secondary>
            </indexterm><indexterm>
              <primary>coordinator instance</primary>
            </indexterm>A SciDB instance that resides on the coordinator
          server. There is a single coordinator instance for a SciDB cluster.
          A coordinator instance coordinates query activity in addition to
          participating in query execution.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>Worker instance</term>

        <listitem>
          <para><indexterm>
              <primary>instances</primary>

              <secondary>worker</secondary>
            </indexterm><indexterm>
              <primary>worker instance</primary>
            </indexterm>A SciDB instance that only participates in query
          execution.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>Cluster</term>

        <listitem>
          <para>A group of one or more single servers connected by TCP/IP,
          working together as a single system. A cluster can be a private grid
          or a public cloud.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>SciDB cluster</term>

        <listitem>
          <para>A collection of SciDB instances (one coordinator and zero or
          more worker instances) form a SciDB cluster.</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>

  <!-- Draft of upgrade chapter: will try to make available for 13.3
  <xi:include href="scidb_upgrade.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
-->

  <section xml:id="DataModelInstall">
    <title>Visualizing a Completed SciDB Installation</title>

    <para><indexterm>
        <primary>architecture</primary>
      </indexterm><indexterm>
        <primary>SciDB</primary>

        <secondary>architecture</secondary>
      </indexterm>This section describes the pieces of a completed SciDB
    installation.</para>

    <section xml:id="DM_IC">
      <title>The SciDB Installation and Its Clusters</title>

      <para>The chapter describes the process for creating one SciDB
      Installation, which consists of one or more SciDB clusters. The
      following conceptual data model diagram expresses this
      graphically.</para>

      <figure>
        <title>SciDB Cluster</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center" contentdepth="500" contentwidth="400"
                       depth="100"
                       fileref="../graphics/dm_InstallationHasClusters.png"
                       scale="30" valign="top" width="400"/>
          </imageobject>
        </mediaobject>
      </figure>

      <para>The figure asserts the following: There are SciDB installations.
      Each SciDB installation has an arbitrary ID and SciDB clusters. There
      are SciDB clusters. Each SciDB cluster has a cluster name, a base path,
      and belongs to one SciDB installation. Within any SciDB installation,
      Each SciDB cluster name is unique.</para>

      <note>
        <para>The data models shown in this chapter are purely conceptual.
        They do not describe any physical data characteristics or connote any
        particular meta-model such as relational, object-oriented, etc. For a
        complete description of this notation, see Mastering Data Modeling: A
        User-Driver Approach by John Carlis et al. (Addison-Wesley,
        2001)</para>
      </note>
    </section>

    <section xml:id="DM_CSI">
      <title>The SciDB Cluster, Servers, and Instances</title>

      <para><indexterm>
          <primary>cluster</primary>
        </indexterm><indexterm>
          <primary>SciDB</primary>

          <secondary>cluster</secondary>
        </indexterm>Each SciDB cluster consists of one or more servers, each
      of which can host one or more server instances.</para>

      <para>Like this:</para>

      <figure>
        <title>SciDB Servers and Instances</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center" contentdepth="500" contentwidth="400"
                       depth="350"
                       fileref="../graphics/dm_clusterHasServerHasInstance.png"
                       scale="30" valign="top" width="400"/>
          </imageobject>
        </mediaobject>
      </figure>

      <para>The figure asserts the following: There are SciDB installations.
      Each SciDB installation has an arbitrary ID and SciDB clusters. There
      are SciDB clusters. Each SciDB cluster has a cluster name, a base path,
      and belongs to one SciDB Installation. Within any SciDB installation,
      each SciDB cluster name is unique. There are servers. Each server has an
      IP address, belongs to one SciDB cluster, and can host multiple
      instances. There are instances. Each instance is hosted by one server.
      Each instance has a port number. Each instance has a unique combination
      of server and port number. (That is, two instances can have the same
      port number, but only if they are hosted by different servers.)</para>
    </section>

    <section xml:id="DM_CI_WI">
      <title>The Coordinator Instance and Worker Instances</title>

      <para>Every instance is either a coordinator instance, a worker
      instance, or both. Each SciDB cluster will have exactly one coordinator
      instance.</para>

      <para>Like this:</para>

      <figure>
        <title>SciDB Instances: Coordinator and Workers</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center" contentdepth="500" contentwidth="400"
                       depth="400"
                       fileref="../graphics/dm_instanceBeCoordinatorOrWorker.png"
                       scale="30" valign="top" width="400"/>
          </imageobject>
        </mediaobject>
      </figure>

      <note>
        <para>A worker instance can also serve as the coordinator instance.
        Such an instance is typically referred to as the coordinator instance,
        but it can share in the workload of SciDB queries like any other
        worker instance.</para>
      </note>

      <para>The figure asserts the following: There are SciDB installations.
      Each SciDB installation has an arbitrary ID and SciDB clusters. There
      are SciDB clusters. Each SciDB cluster has a cluster name, a base path,
      and belongs to one SciDB installation. Within any SciDB installation,
      each SciDB cluster name is unique. There are servers. Each server has an
      IP address, belongs to one SciDB cluster, and can host multiple
      instances. There are instances. Each instance is hosted by one server.
      Each instance has a port number. Each instance has a unique combination
      of server and port number. (That is, two instances can have the same
      port number, but only if they are hosted by different servers.) An
      instance can be a coordinator instance, a worker instance, or both.
      Every coordinator instance is an instance. Every worker instance is an
      instance. Each coordinator instance coordinates the work of one SciDB
      cluster, and each SciDB cluster can be coordinated by one coordinator
      instance.</para>
    </section>

    <section xml:id="DM_CS_WS">
      <title>The Coordinator Server and Worker Servers</title>

      <para><indexterm>
          <primary>coordinator server</primary>
        </indexterm><indexterm>
          <primary>instances</primary>

          <secondary>worker</secondary>
        </indexterm><indexterm>
          <primary>worker server</primary>
        </indexterm>Whichever server hosts the coordinator instance is known
      as the coordinator server. The other servers as known as worker servers.
      In most contexts, the distinction between the coordinator server and
      worker servers is immaterial, and they are collectively known as
      servers. The installation instructions in this chapter direct you to
      install Postgres on the coordinator server. Although the coordinator
      server must host the coordinator instance, it can also host other
      (worker) instances.</para>

      <para>Like this:</para>

      <figure>
        <title>SciDB Servers: Coordinator and Workers</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center" contentdepth="500" contentwidth="400"
                       depth="400"
                       fileref="../graphics/dm_serverBeCoordinatorOrWorker.png"
                       scale="30" valign="top" width="400"/>
          </imageobject>
        </mediaobject>
      </figure>

      <para>The figure asserts the following: There are SciDB installations.
      Each SciDB installation has an arbitrary ID and SciDB clusters. There
      are SciDB clusters. Each SciDB cluster has a cluster name, a base path,
      and belongs to one SciDB installation. Within any SciDB installation,
      each SciDB cluster name is unique. There are servers. Each server has an
      IP address, belongs to one SciDB cluster, and can host multiple
      instances. There are instances. Each instance is hosted by one server.
      Each instance has a port number. Each instance has a unique combination
      of server and port number. (That is, two instances can have the same
      port number, but only if they are hosted by different servers.) An
      instance can be a coordinator instance, a worker instance, or both. Each
      coordinator instance coordinates the work of one SciDB cluster, and each
      SciDB cluster can be coordinated by one coordinator instance. A server
      can be a coordinator server or a worker server. The coordinator server
      hosts the coordinator instance (and because every coordinator instance
      is an instance, might also host other instances). The coordinator server
      will ultimately host the Postgres installation.</para>
    </section>

    <section xml:id="DM_DP_D">
      <title>Disk Partitions and Directories</title>

      <para><indexterm>
          <primary>partitions</primary>
        </indexterm><indexterm>
          <primary>disk partitions</primary>
        </indexterm>When two or more instances are hosted by the same server,
      each of those instances requires its own directory to store SciDB
      database files. Those directories could be on the same disk
      partition.</para>

      <para>Like this:</para>

      <figure>
        <title>Disk Partitions and Directories</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center" contentdepth="500" contentwidth="400"
                       depth="350"
                       fileref="../graphics/dm_disksAndPartitions.png"
                       scale="30" valign="top" width="400"/>
          </imageobject>
        </mediaobject>
      </figure>

      <para>The figure asserts the following: There are SciDB installations.
      Each SciDB installation has an arbitrary ID and SciDB clusters. There
      are SciDB clusters. Each SciDB cluster has a cluster name, a base path,
      and belongs to one SciDB installation. Within any SciDB installation,
      each SciDB cluster name is unique. There are servers. Each server has an
      IP address, belongs to one SciDB cluster, and can host multiple
      instances. There are instances. Each instance is hosted by one server.
      Each instance has a port number. Each instance has a unique combination
      of server and port number. (That is, two instances can have the same
      port number, but only if they are hosted by different servers.) There
      are disk partitions. Each disk partition belongs to one server, and has
      a unique mount point and can have multiple directories. Each directory
      in on one disk partition, has a directory name, and can contain data for
      exactly one instance. Each instance stores its SciDB data on one
      directory.</para>
    </section>

    <section xml:id="DM_Complete">
      <title>Complete SciDB Installation</title>

      <para>The complete data model described in the preceding sections is
      shown below. The model can help you visualize important distinctions
      that arise during the installation process. For example, some steps of
      the installation apply to all servers, whereas others apply only to the
      coordinator server. Likewise, some steps apply only to the coordinator
      instance, whereas other steps apply to all instances.</para>

      <para>The complete model is here:</para>

      <figure>
        <title>SciDB Installation</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center" contentdepth="500" contentwidth="400"
                       depth="400" fileref="../graphics/dm_installFull.png"
                       scale="30" valign="top" width="400"/>
          </imageobject>
        </mediaobject>
      </figure>

      <?dbfo-need height="1.5in" ?>

      <note>
        <para>Remember, this is merely a conceptual model to help you
        understand the building blocks of the installation process. It is a
        conceptual model—not intended to connote any physical data layout or
        any particular meta-model such as relational or object-oriented. For
        that matter, it presents a somewhat simplified view of a SciDB
        configuration, which is all you need to begin the installation
        process.</para>
      </note>
    </section>
  </section>

  <section xml:id="PlatformPrep">
    <title>Preparing the Platform</title>

    <para>If you are upgrading from a previous version of SciDB, you can skip
    this section, and continue with <xref linkend="PackageInstall"/>.</para>

    <para>Before installing SciDB, the following steps are required to prepare
    a cluster for running SciDB. Many of these steps must be executed as the
    Linux 'root' account (creating the scidb account, preparing the system
    catalog, configuring a local data directory for use by SciDB, installing
    SciDB software packages).</para>

    <para>Depending on your operating system, you may need to perform the
    following tasks:<itemizedlist>
        <listitem>
          <para>Ubuntu does not enable root by default. To enable the root
          account on Ubuntu, run the following command:<programlisting>sudo passwd</programlisting>Sudo
          will prompt you for your password, and then ask you to supply a new
          password for root.</para>
        </listitem>

        <listitem>
          <para>For CentOS and RHEL, you should create a user account
          (<command>adduser</command>), and provide sudo access for this
          account. For details, see your OS documentation.</para>
        </listitem>
      </itemizedlist></para>

    <section xml:id="LinuxUserAccount">
      <title><emphasis role="bold">scidb</emphasis> Account</title>

      <note>
        <para>This step must be performed by root, or an account with
        equivalent administrative privileges. The scidb account must be
        available on all servers in the cluster.</para>
      </note>

      <para><indexterm>
          <primary>account, sciDB</primary>
        </indexterm>First, you need to create the<emphasis role="bold">
      scidb</emphasis> account. All SciDB processes as well as data and log
      files are created and owned by this ID. On a cluster, each server must
      have this account. This is also the account that initializes, starts,
      and stops the SciDB cluster.</para>

      <para>The scidb user account must have password-less SSH access
      configured between the coordinator server and all servers in the SciDB
      cluster. How to configure this access is described later in the
      chapter.</para>
    </section>

    <section xml:id="DataDir">
      <title>Configure Storage</title>

      <note>
        <para>This action must be performed by the root account on each server
        in the cluster. Once created the base path should be owned by the
        <emphasis role="bold">scidb</emphasis> account.</para>
      </note>

      <para><indexterm>
          <primary>configuration</primary>
        </indexterm>On each server, select a location on the local file system
      to place the data directory for each instance. This must be accessible
      via the same path name on every server.</para>

      <para>The recommended configuration is 1 disk and 4 CPU cores for each
      SciDB instance. This is easily achieved in a virtual server
      configuration. For physical server configuration, please explore the
      SciDB forum at <ulink
      url="www.scidb.org/forum">www.scidb.org/forum</ulink> for guidance on
      creating an optimal configuration.</para>
    </section>

    <section xml:id="RemoteExecutionConfigurationssh">
      <title>Remote Execution Configuration (SSH)</title>

      <note>
        <para><!--If fixed for next release, re-enter this sentence: This step is only required if you are setting up a cluster environment,
 and can be skipped for single-server installations.-->This step must be
        performed by the scidb user account.</para>
      </note>

      <para><indexterm>
          <primary>ssh</primary>
        </indexterm><indexterm>
          <primary>password-less communication</primary>
        </indexterm><indexterm>
          <primary>communication between instances</primary>
        </indexterm>SciDB uses <code>ssh</code> for execution of management
      commands such as start and stop within a cluster. This is why the
      <emphasis role="bold">scidb</emphasis> user account should have
      password-less <code>ssh</code> access from the coordinator to the
      workers and from the coordinator to itself.</para>

      <para>There are several methods to configure password-less
      <code>SSH</code> between servers. We recommend the following simple
      method.</para>

      <orderedlist>
        <listitem>
          <para>Create a key:<programlisting>ssh-keygen</programlisting>By
          default, this creates a key file with a public/private key pair in
          ~/.ssh/id_rsa.pub and ~/.ssh/id_rsa. Optionally, a key file name may
          be specified. If a non-default filename is used for the key pair, it
          must be listed in the SciDB configuration file for use by
          scidb.py.</para>

          <programlisting>
scidb@monolith1:~/.ssh$ ssh-keygen 
Generating public/private rsa key pair.
Enter file in which to save the key (/home/scidb/.ssh/id_rsa):
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in id_rsa.
Your public key has been saved in id_rsa.pub.
...</programlisting>
        </listitem>

        <listitem>
          <para>Copy the key to the localhost (or coordinator) and to each
          worker to authorize ssh clients connecting to it: <programlisting>ssh-copy-id -i ~/.ssh/id_rsa.pub scidb@worker
ssh-copy-id -i ~/.ssh/id_rsa.pub scidb@localhost</programlisting></para>
        </listitem>

        <listitem>
          <para>Login to remote host. Note that no password is required
          now:<programlisting>ssh scidb@worker</programlisting><note>
              <para>If you are running SciDB on CentOS or RHEL, you may need
              to perform additional configuration steps. See the next section
              for details.</para>
            </note></para>
        </listitem>
      </orderedlist>
    </section>

    <section>
      <title>Additional Configuration on CentOS and RHEL</title>

      <para>This section describes two additional configuration steps that are
      necessary if you are running SciDB on CentOS or RHEL:<itemizedlist>
          <listitem>
            <para>Configure iptables</para>
          </listitem>

          <listitem>
            <para>Configure SELinux</para>
          </listitem>
        </itemizedlist></para>

      <section>
        <title>Configure iptables</title>

        <para><indexterm>
            <primary>firewall</primary>
          </indexterm><indexterm>
            <primary>iptables</primary>
          </indexterm>If you are running on CentOS or RHEL, you need to set up
        iptables, in order for a multi-server configuration of SciDB to
        function properly.</para>

        <para>The iptables program controls a host-based firewall for Linux
        operating systems. For SciDB, you should perform one of the following
        actions:<itemizedlist>
            <listitem>
              <para>Disable iptables. To disable iptables, use either of the
              following commands:<programlisting>chkconfig iptables off # do not start iptables during boot
service iptables stop # stop iptables</programlisting>Or,</para>
            </listitem>

            <listitem>
              <para>Grant connections for the SciDB ports and for the Postgres
              port.</para>
            </listitem>
          </itemizedlist></para>

        <para>To grant connections, perform the following steps:<orderedlist>
            <listitem>
              <para>Use <command>sudo</command>, or login as root to edit the
              <literal>/etc/sysconfig/iptables</literal> file.</para>
            </listitem>

            <listitem>
              <para>On the coordinator instance, grant access for the Postgres
              port, 5432. Insert the following line before the final line
              (COMMIT) of the iptables file:<programlisting>-A INPUT -m state --state NEW -m tcp -p tcp --dport 5432 -j ACCEPT</programlisting></para>
            </listitem>

            <listitem>
              <para>On all instances—the coordinator and all workers—you must
              add a line for each instance port. For example, if you have four
              instances, on ports 1239, 1240, 1241, and 1242, you would add
              the following lines:<programlisting>-A INPUT -m state --state NEW -m tcp -p tcp --dport 1239 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 1240 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 1241 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 1242 -j ACCEPT</programlisting></para>
            </listitem>

            <listitem>
              <para>Restart the iptables service.<programlisting>sudo service iptables restart</programlisting></para>
            </listitem>
          </orderedlist></para>

        <para>Here is an example of the updated iptables file on the
        coordinator:</para>

        <screen># Firewall configuration written by system-config-firewall
# Manual customization of this file is not recommended.
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
# Grant connection for Postgres (coordinator only)
-A INPUT -m state --state NEW -m tcp -p tcp --dport 5432 -j ACCEPT
# Grant SciDB instance connections
-A INPUT -m state --state NEW -m tcp -p tcp --dport 1239 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 1240 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 1241 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 1242 -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
COMMIT</screen>
      </section>

      <section>
        <title>Configure SELinux</title>

        <para>CentOS and RHEL have SELinux (Security-Enhanced Linux) enabled
        by default. This can cause problems when you attempt to set up
        password-less SSH. You can either disable SELinux or configure SELinux
        to allow password-less ssh to function correctly.<itemizedlist>
            <listitem>
              <para>Configure SELinux so that password-less ssh works. As the
              scidb user, run the following commands.<programlisting>cd ~
chmod 700 .ssh
cd .ssh
chmod 600 *
chmod 644 authorized_keys
chmod 644 known_hosts
chmod 644 config
restorecon -R -v ../.ssh</programlisting>Or,</para>
            </listitem>

            <listitem>
              <para>Disable SELinux. For details, see your operating system
              documentation, or search the web for instructions. Note that
              this method may introduce security risks,</para>
            </listitem>
          </itemizedlist></para>
      </section>
    </section>
  </section>

  <section xml:id="PackageInstall">
    <title>Installing Packages</title>

    <para>Packages are available for Ubuntu, CentOS, and RHEL. Note that
    CentOS and RHEL use the same package.</para>

    <para>SciDB currently provides the following packages.</para>

    <itemizedlist>
      <listitem>
        <para>The <code>scidb</code> package contains the server
        binaries.</para>
      </listitem>

      <listitem>
        <para>The <code>libscidbclient</code> and
        <code>libscidbclient-python</code> packages contain the SciDB client
        library and the SciDB connector for python applications.</para>
      </listitem>

      <listitem>
        <para>The <code>scidb-plugins </code>package contains plugins that can
        be added to SciDB to extend its capabilities. This package contains
        the <code>dense_linear_algebra</code> plugin.</para>
      </listitem>

      <listitem>
        <para>The <code>scidb-utils</code> package contains SciDB server
        utilities.</para>
      </listitem>

      <listitem>
        <para>The <code>scidb-dev</code> contains development header files for
        developers creating SciDB extensions (types, operators, and
        aggregates).</para>
      </listitem>

      <listitem>
        <para>The <code>scidb-dev</code> contains development header files for
        developers creating SciDB extensions (types, operators, and
        aggregates).</para>
      </listitem>

      <listitem>
        <para>The <code>libscidbclient-dbg, libscidbclient-python-dbg,
        scidb-dbg, scidb-dev-tools-dbg, scidb-plugins-dbg</code>, and
        <code>scidb-utils-dbg</code> packages contain debugging
        symbols.</para>
      </listitem>
    </itemizedlist>

    <section xml:id="InstallSciDBfrombinarypackage">
      <title>Install SciDB on Ubuntu from binary package</title>

      <para>This section describes how to download and install SciDB on
      Ubuntu, using pre-built binary packages.</para>

      <note>
        <para>This step must be performed by the root account. In a cluster,
        this step must be performed on all servers.</para>
      </note>

      <para>This section describes how to download and install SciDB using
      pre-built binary packages.</para>

      <orderedlist>
        <listitem>
          <para>Add SciDB's GPG public key by running the following command.
          <programlisting>wget -O-  http://downloads.paradigm4.com/key | sudo apt-key add -</programlisting></para>
        </listitem>

        <listitem>
          <para>Add SciDB's APT repository to the apt configuration file
          <code>/etc/apt/sources.list.d/scidb.list</code>. <programlisting>deb  http://downloads.paradigm4.com/  ubuntu12.04/13.1/
deb-src  http://downloads.paradigm4.com/  ubuntu12.04/13.1/</programlisting></para>
        </listitem>

        <listitem>
          <para>Update APT index and install SciDB. If you want the default
          SciDB installation with all packages installed, you can install the
          scidb-all (or scidb-all-coord) metapackage. This package includes
          all of the standard SciDB packages.<programlisting>sudo apt-get update
sudo apt-cache search scidb
sudo apt-get install scidb-all-coord # On the coordinator server only
sudo apt-get install scidb-all # On all servers other than the coordinator server
sudo apt-get source scidb # If you want the SciDB source</programlisting></para>
        </listitem>
      </orderedlist>

      <para>If you want the default SciDB installation with all packages
      installed, you can install the scidb-all (worker) or scidb-all-coord
      (coordinator) metapackage. These packages include all of the standard
      SciDB packages required for a complete installation.</para>

      <note>
        <para>The only difference between the scidb-all and scidb-all-coord
        packages is that scidb-all-coord contains Postgres. If you already
        have Postgres on your coordinator server, there is no need to install
        the scidb-all-coord package.</para>
      </note>
    </section>

    <section xml:id="packageCentOS">
      <title>Install SciDB on CentOS / RHEL from binary package</title>

      <para>This section describes how to download and install SciDB on CentOS
      and RHEL, using pre-built binary packages.</para>

      <note>
        <para>This procedure must be performed by the root account. In a
        cluster, this step must be performed on all servers.</para>
      </note>

      <orderedlist>
        <listitem>
          <para>Add SciDB's GPG public key by running the following command.
          <programlisting>wget http://downloads.paradigm4.com/key
rpm --import key
rm -f key</programlisting></para>
        </listitem>
        <listitem>
          <para>Add the SciDB repository to the repository folder, by creating
          the configuration file
          <code>/etc/yum.repos.d/scidb.repo</code>.</para>
        </listitem>

        <listitem>
          <para>Add the following lines to the
          <code>/etc/yum.repos.d/scidb.repo</code> file:<programlisting>[scidb]
name=SciDB
baseurl=http://downloads.paradigm4.com/centos6.3/13.1/
gpgcheck=1</programlisting></para>
        </listitem>

        <listitem>
          <para>Update packages by running the following
          command:<programlisting>sudo yum update</programlisting><note>
              <para>If you receive an error concerning the boost library,
              remove boost by running the following command, and then rerun
              <command>sudo yum update</command>.</para>

              <programlisting>rpm -qa | grep boost | sudo xargs yum remove -y</programlisting>
            </note></para>
        </listitem>

        <listitem>
          <para>Install SciDB. If you want the default SciDB installation with
          all packages installed, you can install the scidb-all (or
          scidb-all-coord) metapackage. This package includes all of the
          standard SciDB packages.<programlisting>sudo yum search scidb
sudo yum install scidb-all-coord # On the coordinator server only
sudo yum install scidb-all # On all servers other than the coordinator server</programlisting></para>
        </listitem>
      </orderedlist>

      <para>If you want the default SciDB installation with all packages
      installed, you can install the scidb-all (worker) or scidb-all-coord
      (coordinator) metapackage. These packages include all of the standard
      SciDB packages required for a complete installation.</para>

      <note>
        <para>The only difference between the scidb-all and scidb-all-coord
        packages is that scidb-all-coord contains Postgres. If you already
        have Postgres on your coordinator server, there is no need to install
        the scidb-all-coord package.</para>
      </note>
    </section>

    <section xml:id="PostgresInstallationandConfiguration">
      <title>System Catalog Setup</title>

      <para>If you are upgrading from a previous version of SciDB, you can
      skip this section, and continue with <xref
      linkend="ConfiguringSciDB"/>.</para>

      <para><indexterm>
          <primary>system catalog</primary>
        </indexterm><indexterm>
          <primary>Postgres</primary>
        </indexterm><indexterm>
          <primary>security, Postgres</primary>
        </indexterm>SciDB relies on Postgres as the system catalog. In this
      section, we describe how to set up and use Postgres <emphasis
      role="bold">for SciDB</emphasis>.</para>

      <warning>
        <para>We strongly recommend that you use a separate Postgres
        installation exclusively for SciDB. The main reason for this is that
        SciDB needs to store the password for the 'scidb' user in clear text
        in a configuration file. Thus, if you use an existing Postgres
        installation for SciDB, you introduce a security risk into the
        existing Postgres installation.</para>
      </warning>

      <para>Note the following:<itemizedlist>
          <listitem>
            <para>SciDB requires Postgres 8.4. This version is typically
            available on most Linux platforms. If your platform provides
            multiple versions of Postgres, make sure that version 8.4 is
            running and using port 5432.</para>
          </listitem>

          <listitem>
            <para>The installation and configuration of Postgres must be
            performed by root, or an account with equivalent administrative
            privileges.</para>
          </listitem>

          <listitem>
            <para>You install and configure Postgres on the coordinator server
            only.</para>
          </listitem>
        </itemizedlist></para>

      <para>By default, Postgres is configured to allow only local access via
      Unix-domain sockets. In a cluster environment, the Postgres database
      server needs to be configured to allow access from other instances in
      the cluster. To do this, perform the following steps:</para>

      <procedure>
        <step>
          <para>If you have never previously run Postgres on your system, you
          must perform the following steps:</para>

          <substeps>
            <step>
              <para>Run the following command to create the
              <literal>pg_hba.conf</literal> file (you will edit this file in
              step 2):<programlisting>sudo service postgresql initdb</programlisting></para>
            </step>

            <step>
              <para>Create a PostgreSQL user on your Linux system. For
              details, see the Postgres documentation.</para>
            </step>
          </substeps>
        </step>

        <step>
          <para>Configure Postgres to use 'trust' authentication for local and
          remote connections. To do this, modify the
          <literal>pg_hba.conf</literal> file (usually at
          <literal>/etc/postgresql/8.4/main/</literal> or
          <literal>/var/lib/pgsql/data/</literal>) and include the following
          settings.<programlisting>
local   all      all                      trust
host    all      all     10.0.0.1/8       trust</programlisting></para>

          <para>This configuration setting causes Postgres to use 'trust'
          authentication for all local and remote connections from instances
          within the 10.0.0.1/8 subnet. Replace the subnet/mask with the
          correct one for your cluster.<note>
              <para>If you are installing on a Red Hat Enterprise Linux (RHEL)
              operating system, you must enable trust authentication for
              <emphasis>all</emphasis> entries in the
              <literal>pg_hba.conf</literal> file.</para>
            </note></para>
        </step>

        <step>
          <para>You might need to set the <literal>postgresql.conf</literal>
          file to have it listen on the relevant port. If you are running a
          cluster with multiple servers, you will also need to modify the
          <literal>postgresql.conf</literal> file to allow connections from
          other instances in the cluster.<programlisting># - Connection Settings -
listen_addresses = '*'
port = 5432
</programlisting></para>
        </step>

        <step>
          <para>Restart Postgres.<programlisting>sudo /etc/init.d/postgresql restart
</programlisting></para>
        </step>

        <step>
          <para>The final step, after you have configured Postgres, is to add
          it to Linux system services. This means that Postgres will be
          started automatically on system reboot.<programlisting>sudo /sbin/chkconfig --add postgresql</programlisting>To
          run the previous command, you need to install the chkconfig package,
          if it is not already installed on your system.</para>
        </step>
      </procedure>

      <warning>
        <para>This Postgres configuration might pose security issues. When
        authentication is set to trust PostgreSQL assumes that anyone who can
        connect to the server is authorized to access the database. To make a
        more secure installation, you can list specific host IP addresses,
        user names, and role mappings.</para>

        <para>You can read more on the security details of Postgres
        client-authentication in the Postgres documentation at <ulink
        url="http://www.postgresql.org/docs/8.3/static/client-authentication.html"/>.</para>
      </warning>

      <para>You can verify that a PostgreSQL instance is running on the
      coordinator with the <literal>status</literal> command: <programlisting>sudo /etc/init.d/postgresql status
</programlisting></para>
    </section>
  </section>

  <section xml:id="ConfiguringSciDB">
    <title>Configuring SciDB</title>

    <para>This section introduces the SciDB config.ini and shows how to
    configure SciDB prior to initialization (usually
    <literal>/opt/scidb/13.1/etc/config.ini</literal>). Logging configuration
    is also described.</para>

    <section>
      <title>SciDB Configuration File</title>

      <note>
        <para>The configuration file resides on the coordinator server
        only.</para>
      </note>

      <para><indexterm>
          <primary>configuration</primary>
        </indexterm>The standard location of the SciDB configuration file is
      <literal>/opt/scidb/13.1/etc/config.ini</literal>.</para>

      <para>The configuration 'test1' below is an example of the configuration
      for a single-instance system (coordinator only):<programlisting>[test1]
server-0=localhost,0
db_user=test1user
db_passwd=test1passwd
install_root=/opt/scidb/13.1
metadata=/opt/scidb/13.1/share/scidb/meta.sql
pluginsdir=/opt/scidb/13.1/lib/scidb/plugins
logconf=/opt/scidb/13.1/share/scidb/log4cxx.properties
base-path=/home/scidb/data
base-port=1239
interface=eth0
network-buffer=1024
mem-array-threshold=1024
smgr-cache-size=1024
execution-threads=16
result-prefetch-queue-size=4
result-prefetch-threads=4
chunk-segment-size=100485760
</programlisting></para>
    </section>

    <section xml:id="EnvironmentVariables2">
      <title>Set Environment Variables</title>

      <note>
        <para>You set the environment variables on the coordinator server
        only.</para>
      </note>

      <para><indexterm>
          <primary>environment variables</primary>
        </indexterm>The following variables should be set in the scidb user's
      environment. <programlisting>
export SCIDB_VER=13.1
export PATH=/opt/scidb/$SCIDB_VER/bin:
   /opt/scidb/$SCIDB_VER/share/scidb:$PATH
export LD_LIBRARY_PATH=/opt/scidb/$SCIDB_VER/lib:$LD_LIBRARY_PATH</programlisting></para>
    </section>

    <section>
      <title>Cluster Configuration Example</title>

      <para><indexterm>
          <primary>configuration</primary>

          <secondary>example</secondary>
        </indexterm>The following SciDB cluster configuration is called
      'monolith.' This cluster consists of eight identical virtual servers
      with the following characteristics:<itemizedlist>
          <listitem>
            <para>x86_64 6-core processor</para>
          </listitem>

          <listitem>
            <para>8 GB of RAM</para>
          </listitem>

          <listitem>
            <para>1 TB direct attached storage</para>
          </listitem>

          <listitem>
            <para>1Gbps Ethernet</para>
          </listitem>

          <listitem>
            <para>Linux OS from the list of supported distributions.</para>
          </listitem>
        </itemizedlist></para>

      <para>The following configuration file applies to such a cluster called
      <code>monolith</code> and is explained in the following section.
      <programlisting>
[monolith]
# server-id=IP, number of worker instances
server-0=10.0.20.231,0
server-1=10.0.20.232,1
server-2=10.0.20.233,1
server-3=10.0.20.234,1
server-4=10.0.20.235,1
server-5=10.0.20.236,1
server-6=10.0.20.237,1
server-7=10.0.20.238,1
db_user=monolith
db_passwd=monolith
install_root=/opt/scidb/13.1
metadata=/opt/scidb/13.1/share/scidb/meta.sql
pluginsdir=/opt/scidb/13.1/lib/scidb/plugins
logconf=/opt/scidb/log4cxx.properties.trace
base-path=/data/monolith_data
base-port=1239
interface=eth0</programlisting></para>

      <para>The install package contains a sample configuration file,
      <literal>sample_config.ini</literal> with examples which must be
      customized and copied to <literal>config.ini</literal>.</para>

      <para><indexterm>
          <primary>configuration</primary>

          <secondary>parameters</secondary>
        </indexterm>The following table describes the basic configuration file
      settings:</para>

      <informaltable frame="all">
        <tgroup cols="2">
          <colspec colname="c1" colwidth="20*"/>

          <colspec colname="c2" colwidth="60*"/>

          <tbody>
            <row>
              <entry nameend="c2" namest="c1">
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Basic Configuration</emphasis>
                  </emphasis>
                </para>
              </entry>
            </row>

            <row>
              <entry>
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Key</emphasis>
                  </emphasis>
                </para>
              </entry>

              <entry>
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Value</emphasis>
                  </emphasis>
                </para>
              </entry>
            </row>

            <row>
              <entry>
                <para>Cluster name</para>
              </entry>

              <entry>
                <para>Name of the SciDB cluster. The cluster name must appear
                as a section heading in the config.ini file, e.g.,<emphasis>
                [cluster1]</emphasis></para>
              </entry>
            </row>

            <row>
              <entry>
                <para>server-N, w</para>
              </entry>

              <entry>
                <para>The host name or IP address of server N, where N = 0, 1,
                2, ..., followed by a comma, followed by the number of worker
                instances <code>w</code> to launch on the server. The
                coordinator is always on server-0 and launches at least one
                instance that serves as database coordinator.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>db_user</para>
              </entry>

              <entry>
                <para>Username to use in the catalog connection string. This
                example uses<emphasis> test1user</emphasis></para>
              </entry>
            </row>

            <row>
              <entry>
                <para>db_passwd</para>
              </entry>

              <entry>
                <para>Password to use in the catalog connection string. This
                example uses<emphasis> test1passwd</emphasis></para>
              </entry>
            </row>

            <row>
              <entry>
                <para>install_root</para>
              </entry>

              <entry>
                <para>Full path to the SciDB installation directory.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>metadata</para>
              </entry>

              <entry>
                <para>Full path to the SciDB metadata definition file.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>pluginsdir</para>
              </entry>

              <entry>
                <para>Full path to the SciDB plugins directory that contains
                all server plugins.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>logconf</para>
              </entry>

              <entry>
                <para>Full path to the <emphasis role="bold">log4xx</emphasis>
                logging configuration file.</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para><indexterm>
          <primary>configuration</primary>

          <secondary>parameters</secondary>
        </indexterm>The following table describes the cluster configuration
      file contents and how to set them:</para>

      <informaltable frame="all">
        <tgroup cols="2">
          <colspec colname="c1" colwidth="20*"/>

          <colspec colname="c2" colwidth="60*"/>

          <tbody>
            <row>
              <entry nameend="c2" namest="c1">
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Cluster Configuration</emphasis>
                  </emphasis>
                </para>
              </entry>
            </row>

            <row>
              <entry>
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Key</emphasis>
                  </emphasis>
                </para>
              </entry>

              <entry>
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Value</emphasis>
                  </emphasis>
                </para>
              </entry>
            </row>

            <row>
              <entry>
                <para>base-path</para>
              </entry>

              <entry>
                <para>The root data directory for each SciDB instance. Each
                SciDB instance uses an enumerated data directory below the
                base-path. The <code>list('instances')</code> command shows
                all instances and their data directories for a running SciDB
                cluster.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>base-port (optional)</para>
              </entry>

              <entry>
                <para>Base port number. Connections to the coordinator (and
                therefore to the system) are via this port number, while
                worker instances communicate via base-port + instance number.
                The default port number for the SciDB coordinator is
                1239.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>data-dir-prefix (optional)</para>
              </entry>

              <entry>
                <para>The SciDB administrator can provide file system
                directories for reference to multiple disks that are connected
                to a single server. For example, if a server has 4 disks and 8
                instances, your configuration could be as follows:</para>

                <para>
                  <literallayout>data-dir-prefix-0-0=/datadisk1/myserver.000.0
data-dir-prefix-0-1=/datadisk2/myserver.000.1
data-dir-prefix-0-2=/datadisk3/myserver.000.2
data-dir-prefix-0-3=/datadisk4/myserver.000.3
data-dir-prefix-0-4=/datadisk1/myserver.000.4
data-dir-prefix-0-5=/datadisk2/myserver.000.5
data-dir-prefix-0-6=/datadisk3/myserver.000.6
data-dir-prefix-0-7=/datadisk4/myserver.000.7</literallayout>
                </para>

                <para>You do not need to specify this parameter for each
                instance. For any instance that you omit, SciDB creates a
                folder using the default naming scheme.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>interface</para>
              </entry>

              <entry>
                <para>Ethernet interface that SciDB uses.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>pg-port (optional)</para>
              </entry>

              <entry>
                <para>The listening port of Postgres—the port on which
                Postgres accepts incoming connections. Default: 5432.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>ssh-port (optional)</para>
              </entry>

              <entry>
                <para>The port that ssh uses for communications within the
                cluster. Default:22.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>key-file-list (optional)</para>
              </entry>

              <entry>
                <para>Comma-separated list of filenames that include keys for
                ssh authentication. Default: /home/scidb/.ssh/id_rsa and
                id_dsa.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>tmp-path (optional)</para>
              </entry>

              <entry>
                <para>Full path to temporary directory. Default is a directory
                within <code>base-path.</code></para>
              </entry>
            </row>

            <row>
              <entry>
                <para>no-watchdog (optional)</para>
              </entry>

              <entry>
                <para>Set this to true if you do not want automatic restart of
                the SciDB server on a software crash. Default: false.</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para><indexterm>
          <primary>configuration</primary>

          <secondary>tuning</secondary>
        </indexterm><indexterm>
          <primary>optimization</primary>
        </indexterm>The following table describes the configuration file
      elements for tuning your system performance:</para>

      <informaltable frame="all">
        <tgroup cols="2">
          <colspec colname="c1" colwidth="30*"/>

          <colspec colname="c2" colwidth="60*"/>

          <tbody>
            <row>
              <entry nameend="c2" namest="c1">
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Performance Configuration</emphasis>
                  </emphasis>
                </para>
              </entry>
            </row>

            <row>
              <entry>
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Key</emphasis>
                  </emphasis>
                </para>
              </entry>

              <entry>
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Value</emphasis>
                  </emphasis>
                </para>
              </entry>
            </row>

            <row>
              <entry>
                <para>save-ram (optional)</para>
              </entry>

              <entry>
                <para>'True', 'true', 'on' or 'On' will enable this option.
                'Off' by default. This setting, when true, is a hint to write
                temporary data directly to disk files without caching them,
                thereby saving memory at the cost of performance. Default:
                False or 'Off'.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>mem-array-threshold (optional)</para>
              </entry>

              <entry>
                <para>Maximum size in MB of temporary data to be cached in
                memory, before writing to temporary disk files. Default: 1024
                MB. Note that even if save-ram is true, some parts of the
                system may still ignore the hint, and use the cache.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>smgr-cache-size (optional)</para>
              </entry>

              <entry>
                <para>Size of memory in MB allocated to the global shared
                cache of array chunks. Only chunks belonging to stored arrays
                are written to this cache. Default: 256 MB</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>max-memory-limit (optional)</para>
              </entry>

              <entry>
                <para>The hard-limit maximum amount of memory in MB that the
                SciDB instance shall be allowed to allocate. If the instance
                requests more memory from the operating system the allocation
                will fail with an exception. Default: No limit.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>merge-sort-buffer (optional)</para>
              </entry>

              <entry>
                <para>Size of memory buffer used in merge sort, in MB.
                Default: 512 MB.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>chunk-segment-size (optional)</para>
              </entry>

              <entry>
                <para>Size of a storage segment in bytes. Set to a nonzero
                value to enable reuse of storage from removed arrays. If this
                number is set to a nonzero value, it must be large enough to
                contain the largest chunk of the array. If set to zero, no
                space reuse or storage reclamation is done. Default value:
                85MB. Maximum size: 2,147,483,647 B (= 2GB).</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>execution-threads (optional)</para>
              </entry>

              <entry>
                <para>Size of thread pool available for query execution.
                Shared pool of threads used by all queries for network IO and
                some query execution tasks. Default: 4.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>operator-threads (optional)</para>
              </entry>

              <entry>
                <para>Number of threads used per operator per query. Limit the
                number of threads allocated per (multi-threaded) operator in a
                query. If operator-threads is unspecified, SciDB automatically
                detects the number of CPU cores and uses that value. If you
                are running multiple instances on each server,
                operator-threads must be set lower than the number of CPU
                cores since multiple SciDB instances share the same set of CPU
                cores. Default: Number of CPU cores.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>result-prefetch-threads (optional)</para>
              </entry>

              <entry>
                <para>Per-query threads available for prefetch. Default:
                4.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>result-prefetch-queue-size (optional)</para>
              </entry>

              <entry>
                <para>Per-query number of result chunks to prefetch. Default:
                4.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>small-memalloc-size (optional)</para>
              </entry>

              <entry>
                <para>Small allocation threshold size in bytes for glibc
                malloc. All memory allocations larger than this size will be
                treated as "large" and pass through to Linux mmap.
                M_MMAP_THRESHOLD setting for malloc. Default: 268,435,456
                bytes (256 MB)</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>large-memalloc-limit (optional)</para>
              </entry>

              <entry>
                <para>Threshold limit on the maximum number of simultaneous
                large allocations for glibc malloc. M_MMAP_MAX setting for
                malloc. Default: 65,536.</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>In the example above, <code>db_user</code> is set to<emphasis>
      test1user</emphasis> and <code>db_passwd</code> is set to
      <emphasis>test1passwd</emphasis>.</para>
    </section>

    <section id="configParameters">
      <title>SciDB Configuration Parameters</title>

      <para><indexterm>
          <primary>configuration</primary>

          <secondary>parameters</secondary>
        </indexterm>The following table describes the basic configuration file
      settings for SciDB:</para>

      <informaltable frame="all">
        <tgroup cols="2">
          <colspec colname="c1" colwidth="20*"/>

          <colspec colname="c2" colwidth="60*"/>

          <tbody>
            <row>
              <entry nameend="c2" namest="c1">
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Basic Configuration</emphasis>
                  </emphasis>
                </para>
              </entry>
            </row>

            <row>
              <entry>
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Key</emphasis>
                  </emphasis>
                </para>
              </entry>

              <entry>
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Value</emphasis>
                  </emphasis>
                </para>
              </entry>
            </row>

            <row>
              <entry>
                <para>Cluster name</para>
              </entry>

              <entry>
                <para>Name of the SciDB cluster. The cluster name must appear
                as a section heading in the config.ini file, e.g.,<emphasis>
                [cluster1]</emphasis></para>
              </entry>
            </row>

            <row>
              <entry>
                <para>server-N, w</para>
              </entry>

              <entry>
                <para>The host name or IP address of server N, where N = 0, 1,
                2, ..., followed by a comma, followed by the number of worker
                instances <code>w</code> to launch on the server. The
                coordinator is always on server-0 and launches at least one
                instance that serves as database coordinator.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>db_user</para>
              </entry>

              <entry>
                <para>Username to use in the catalog connection string. This
                example uses<emphasis> test1user</emphasis></para>
              </entry>
            </row>

            <row>
              <entry>
                <para>db_passwd</para>
              </entry>

              <entry>
                <para>Password to use in the catalog connection string. This
                example uses<emphasis> test1passwd</emphasis></para>
              </entry>
            </row>

            <row>
              <entry>
                <para>install_root</para>
              </entry>

              <entry>
                <para>Full path to the SciDB installation directory.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>metadata</para>
              </entry>

              <entry>
                <para>Full path to the SciDB metadata definition file.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>pluginsdir</para>
              </entry>

              <entry>
                <para>Full path to the SciDB plugins directory that contains
                all server plugins.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>logconf</para>
              </entry>

              <entry>
                <para>Full path to the <emphasis role="bold">log4xx</emphasis>
                logging configuration file.</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para><indexterm>
          <primary>configuration</primary>

          <secondary>parameters</secondary>
        </indexterm>The following table describes the cluster configuration
      file contents and how to set them:</para>

      <informaltable frame="all">
        <tgroup cols="2">
          <colspec colname="c1" colwidth="20*"/>

          <colspec colname="c2" colwidth="60*"/>

          <tbody>
            <row>
              <entry nameend="c2" namest="c1">
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Cluster Configuration</emphasis>
                  </emphasis>
                </para>
              </entry>
            </row>

            <row>
              <entry>
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Key</emphasis>
                  </emphasis>
                </para>
              </entry>

              <entry>
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Value</emphasis>
                  </emphasis>
                </para>
              </entry>
            </row>

            <row>
              <entry>
                <para>base-path</para>
              </entry>

              <entry>
                <para>The root data directory for each SciDB instance. Each
                SciDB instance uses an enumerated data directory below the
                base-path. The <code>list('instances')</code> command shows
                all instances and their data directories for a running SciDB
                cluster.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>base-port (optional)</para>
              </entry>

              <entry>
                <para>Base port number. Connections to the coordinator (and
                therefore to the system) are via this port number, while
                worker instances communicate via base-port + instance number.
                The default port number for the SciDB coordinator is
                1239.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>data-dir-prefix (optional)</para>
              </entry>

              <entry>
                <para>The SciDB administrator can provide file system
                directories for reference to multiple disks that are connected
                to a single server. For example, if a server has 4 disks and 8
                instances, your configuration could be as follows:</para>

                <para>
                  <literallayout>data-dir-prefix-0-0=/datadisk1/myserver.000.0
data-dir-prefix-0-1=/datadisk2/myserver.000.1
data-dir-prefix-0-2=/datadisk3/myserver.000.2
data-dir-prefix-0-3=/datadisk4/myserver.000.3
data-dir-prefix-0-4=/datadisk1/myserver.000.4
data-dir-prefix-0-5=/datadisk2/myserver.000.5
data-dir-prefix-0-6=/datadisk3/myserver.000.6
data-dir-prefix-0-7=/datadisk4/myserver.000.7</literallayout>
                </para>

                <para>You do not need to specify this parameter for each
                instance. For any instance that you omit, SciDB creates a
                folder using the default naming scheme.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>interface</para>
              </entry>

              <entry>
                <para>Ethernet interface that SciDB uses.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>pg-port (optional)</para>
              </entry>

              <entry>
                <para>The listening port of Postgres—the port on which
                Postgres accepts incoming connections. Default: 5432.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>ssh-port (optional)</para>
              </entry>

              <entry>
                <para>The port that ssh uses for communications within the
                cluster. Default:22.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>key-file-list (optional)</para>
              </entry>

              <entry>
                <para>Comma-separated list of filenames that include keys for
                ssh authentication. Default: /home/scidb/.ssh/id_rsa and
                id_dsa.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>tmp-path (optional)</para>
              </entry>

              <entry>
                <para>Full path to temporary directory. Default is a directory
                within <code>base-path.</code></para>
              </entry>
            </row>

            <row>
              <entry>
                <para>no-watchdog (optional)</para>
              </entry>

              <entry>
                <para>Set this to true if you do not want automatic restart of
                the SciDB server on a software crash. Default: false.</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para><indexterm>
          <primary>configuration</primary>

          <secondary>tuning</secondary>
        </indexterm><indexterm>
          <primary>optimization</primary>
        </indexterm>The following table describes the configuration file
      elements for tuning your system performance:</para>

      <informaltable frame="all">
        <tgroup cols="2">
          <colspec colname="c1" colwidth="30*"/>

          <colspec colname="c2" colwidth="60*"/>

          <tbody>
            <row>
              <entry nameend="c2" namest="c1">
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Performance Configuration</emphasis>
                  </emphasis>
                </para>
              </entry>
            </row>

            <row>
              <entry>
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Key</emphasis>
                  </emphasis>
                </para>
              </entry>

              <entry>
                <para>
                  <emphasis role="bold">
                    <emphasis role="bold">Value</emphasis>
                  </emphasis>
                </para>
              </entry>
            </row>

            <row>
              <entry>
                <para>save-ram (optional)</para>
              </entry>

              <entry>
                <para>'True', 'true', 'on' or 'On' will enable this option.
                'Off' by default. This setting, when true, is a hint to write
                temporary data directly to disk files without caching them,
                thereby saving memory at the cost of performance. Default:
                False or 'Off'.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>mem-array-threshold (optional)</para>
              </entry>

              <entry>
                <para>Maximum size in MB of temporary data to be cached in
                memory, before writing to temporary disk files. Default: 1024
                MB. Note that even if save-ram is true, some parts of the
                system may still ignore the hint, and use the cache.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>smgr-cache-size (optional)</para>
              </entry>

              <entry>
                <para>Size of memory in MB allocated to the global shared
                cache of array chunks. Only chunks belonging to stored arrays
                are written to this cache. Default: 256 MB</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>max-memory-limit (optional)</para>
              </entry>

              <entry>
                <para>The hard-limit maximum amount of memory in MB that the
                SciDB instance shall be allowed to allocate. If the instance
                requests more memory from the operating system the allocation
                will fail with an exception. Default: No limit.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>merge-sort-buffer (optional)</para>
              </entry>

              <entry>
                <para>Size of memory buffer used in merge sort, in MB.
                Default: 512 MB.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>chunk-segment-size (optional)</para>
              </entry>

              <entry>
                <para>Size of a storage segment in bytes. Set to a nonzero
                value to enable reuse of storage from removed arrays. If this
                number is set to a nonzero value, it must be large enough to
                contain the largest chunk of the array. If set to zero, no
                space reuse or storage reclamation is done. Default value:
                85MB. Maximum size: 2,147,483,647 B (= 2GB).</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>execution-threads (optional)</para>
              </entry>

              <entry>
                <para>Size of thread pool available for query execution.
                Shared pool of threads used by all queries for network IO and
                some query execution tasks. Default: 4.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>operator-threads (optional)</para>
              </entry>

              <entry>
                <para>Number of threads used per operator per query. Limit the
                number of threads allocated per (multi-threaded) operator in a
                query. If operator-threads is unspecified, SciDB automatically
                detects the number of CPU cores and uses that value. If you
                are running multiple instances on each server,
                operator-threads must be set lower than the number of CPU
                cores since multiple SciDB instances share the same set of CPU
                cores. Default: Number of CPU cores.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>result-prefetch-threads (optional)</para>
              </entry>

              <entry>
                <para>Per-query threads available for prefetch. Default:
                4.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>result-prefetch-queue-size (optional)</para>
              </entry>

              <entry>
                <para>Per-query number of result chunks to prefetch. Default:
                4.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>small-memalloc-size (optional)</para>
              </entry>

              <entry>
                <para>Small allocation threshold size in bytes for glibc
                malloc. All memory allocations larger than this size will be
                treated as "large" and pass through to Linux mmap.
                M_MMAP_THRESHOLD setting for malloc. Default: 268,435,456
                bytes (256 MB)</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>large-memalloc-limit (optional)</para>
              </entry>

              <entry>
                <para>Threshold limit on the maximum number of simultaneous
                large allocations for glibc malloc. M_MMAP_MAX setting for
                malloc. Default: 65,536.</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>In the example above, <code>db_user</code> is set to<emphasis>
      test1user</emphasis> and <code>db_passwd</code> is set to
      <emphasis>test1passwd</emphasis>.</para>
    </section>

    <section xml:id="LoggingConfiguration">
      <title>Logging Configuration</title>

      <itemizedlist>
        <listitem>
          <para>x86 6-core processor</para>
        </listitem>
      </itemizedlist>

      <para><indexterm>
          <primary>configuration</primary>

          <secondary>logging</secondary>
        </indexterm>SciDB uses Apache's log4cxx (<ulink
      url="http://logging.apache.org/log4cxx/">http://logging.apache.org/log4cxx/</ulink>).</para>

      <para>The logging configuration file, specified by the
      <literal>logconf</literal> variable in <literal>config.ini</literal>,
      contains the following Apache log4cxx logger settings:<programlisting>###
# Levels: TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL
###

log4j.rootLogger=ERROR, file

log4j.appender.file=org.apache.log4j.RollingFileAppender
log4j.appender.file.File=scidb.log
log4j.appender.file.MaxFileSize=10000KB
log4j.appender.file.MaxBackupIndex=2
log4j.appender.file.layout=org.apache.log4j.PatternLayout
log4j.appender.file.layout.ConversionPattern=%d [%t] [%-5p]: %m%n</programlisting></para>
    </section>
  </section>

  <xi:include href="scidb_bestpractices.xml"
                xmlns:xi="http://www.w3.org/2001/XInclude"/>

  <section xml:id="InitializingandStartingSciDB">
    <title>Initializing and Starting SciDB</title>

    <section xml:id="Thescidb.pyScript">
      <title>The scidb.py Script</title>

      <para><indexterm>
          <primary>scidb.py</primary>
        </indexterm><indexterm>
          <primary>scidb script</primary>
        </indexterm>To begin a SciDB session, use the
      <literal>scidb.py</literal> script. In a standard SciDB build, this
      script is located at:<programlisting>/opt/scidb/<replaceable>version.number</replaceable>/bin</programlisting></para>

      <para>The syntax for the <literal>scidb.py</literal> script is:
      <programlisting>scidb.py <replaceable>command</replaceable> <replaceable>db</replaceable> <replaceable>conffile</replaceable></programlisting></para>

      <para>The options for the <replaceable>command</replaceable> argument
      are:</para>

      <informaltable frame="all">
        <tgroup cols="2">
          <colspec colname="c1" colwidth="30*"/>

          <colspec colname="c2" colwidth="50*"/>

          <tbody>
            <row>
              <entry>
                <para>
                  <code>init_syscat</code>
                </para>
              </entry>

              <entry>
                <para>Initialize the SciDB system catalog. <emphasis
                role="bold"> Warning</emphasis>: This will remove any existing
                SciDB arrays from the current namespace and recreate the
                system catalog entries for this database. This must be run as
                user 'root' or as user 'Postgres' since it requires
                administrative privileges to the Postgres database.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para><code>initall</code> and
                <code>initall-force</code></para>
              </entry>

              <entry>
                <para>Initialize the SciDB instances. This initializes SciDB
                on coordinator and worker instances and register them in the
                system catalog. <emphasis role="bold"> Warning</emphasis>:
                This will delete all data and log files corresponding to these
                instances.</para>

                <para>initall-force forces initialization without prompting
                the user.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>
                  <code>startall</code>
                </para>
              </entry>

              <entry>
                <para>Start the SciDB database service.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>
                  <code>stopall</code>
                </para>
              </entry>

              <entry>
                <para>Stop the SciDB database service.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>
                  <code>status</code>
                </para>
              </entry>

              <entry>
                <para>Show the status of the SciDB service.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>
                  <code>dbginfo</code>
                </para>
              </entry>

              <entry>
                <para>Collect debugging information by getting all logs,
                cores, and install files.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>
                  <code>dbginfo-lt</code>
                </para>
              </entry>

              <entry>
                <para>Collect only stack and log information for
                debugging.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>
                  <code>version</code>
                </para>
              </entry>

              <entry>
                <para><indexterm>
                    <primary>versions</primary>

                    <secondary>SciDB</secondary>
                  </indexterm>Display SciDB version number information.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>
                  <code>check-pids</code>
                </para>
              </entry>

              <entry>
                <para>List process IDs of SciDB on all instances.</para>
              </entry>
            </row>

            <row>
              <entry>
                <para>
                  <code>check-version</code>
                </para>
              </entry>

              <entry>
                <para>Display the SciDB version information on each instance.
                This is useful in verifying that all instances in the cluster
                are running the same version.</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>The <replaceable>db</replaceable> argument is the name of the
      SciDB cluster you want to create or get information about.</para>

      <para>The configuration file is set by default to
      <code>/opt/scidb/13.1/etc/config.ini</code>. If you want to use a custom
      configuration file for a particular SciDB cluster, use the
      <replaceable>conffile</replaceable> argument.</para>

      <para>Run the following command to initialize SciDB on the server. If
      the SciDB user has sudo privileges, everything will be done
      automatically (otherwise see <xref
      linkend="PostgresInstallationandConfiguration"/> for additional Postgres
      configuration steps):</para>

      <para>First, initialize the system catalog database in Postgres. This
      must be done as user Postgres, therefore, this command must be run as
      user Postgres, or as superuser as follows. <programlisting>sudo -u postgres /opt/scidb/13.1/bin/scidb.py init_syscat <replaceable>db</replaceable></programlisting></para>

      <para>The remainder of the commands are runs as user
      'scidb.'<programlisting>scidb.py initall <replaceable>db</replaceable></programlisting></para>

      <warning>
        <para>This will reinitialize the SciDB database. Any arrays that you
        have created in previous SciDB sessions will be removed and
        corresponding storage files will be deleted.</para>
      </warning>

      <para>To start the set of local SciDB instances specified in your
      config.ini file, use the following command: <programlisting>scidb.py startall <replaceable>db</replaceable></programlisting></para>

      <para>This will report the status of the various
      instances:<programlisting>scidb.py status <replaceable>db</replaceable></programlisting></para>

      <para>This will stop all SciDB instances:<programlisting>scidb.py stopall <replaceable>db</replaceable></programlisting></para>
    </section>

    <section id="sciDBLogs">
      <title>SciDB Logs</title>

      <para><indexterm>
          <primary>logs</primary>
        </indexterm>SciDB logs are written to the file
      <literal>scidb.log</literal> in the appropriate directories for each
      instance: <replaceable>base-path</replaceable>/000/0 for the coordinator
      and
      <replaceable>base-path</replaceable>/<replaceable>M</replaceable>/<replaceable>N</replaceable>
      for the server <replaceable>M</replaceable> instance
      <replaceable>N</replaceable>. Consider an installation with four
      servers, S1, S2, S3, and S4, and 8 instances per server.<itemizedlist>
          <listitem>
            <para>S1 is the coordinator server, and contains 1 coordinator
            instance and 7 worker instances in the following directories:
            <replaceable>base-path</replaceable>/000/0,
            <replaceable>base-path</replaceable>/000/1,
            <replaceable>base-path</replaceable>/000/2, ...
            <replaceable>base-path</replaceable>/000/7</para>
          </listitem>

          <listitem>
            <para>S2 is server, and contains 8 worker instances in the
            following directories: <replaceable>base-path</replaceable>/001/1,
            <replaceable>base-path</replaceable>/001/2, ...
            <replaceable>base-path</replaceable>/001/8</para>
          </listitem>

          <listitem>
            <para>S3 is server, and contains 8 worker instances in the
            following directories: <replaceable>base-path</replaceable>/002/1,
            <replaceable>base-path</replaceable>/002/2, ...
            <replaceable>base-path</replaceable>/002/8</para>
          </listitem>

          <listitem>
            <para>S4 is server, and contains 8 worker instances in the
            following directories: <replaceable>base-path</replaceable>/003/1,
            <replaceable>base-path</replaceable>/003/2, ...
            <replaceable>base-path</replaceable>/003/8</para>
          </listitem>
        </itemizedlist></para>
    </section>
  </section>

  <section id="scidb_on_ec2">
    <title>SciDB on Amazon EC2</title>

    <para><indexterm>
        <primary>cloud, running sciDB</primary>
      </indexterm><indexterm>
        <primary>SciDB</primary>

        <secondary>in the cloud</secondary>
      </indexterm>Amazon Elastic Compute Cloud (EC2) is a central part of
    Amazon.com's cloud computing platform. A public Amazon Machine Image (AMI)
    from Paradigm4 is available on EC2 as
    <code>SciDB_12_10-Ubuntu-10_04-Sep-14-2012 (ami-80e950e9)</code>. This AMI
    has been pre-installed and pre-configured with release 13.1 of
    SciDB.</para>

    <note>
      <para>You need to have an Amazon Web Services account, and there is a
      small hourly fee associated with using the Amazon EC2 service.</para>
    </note>

    <orderedlist>
      <listitem>
        <para>Use Amazon Web Services (AWS) to create and set up a virtual
        Amazon Machine Instance. For details, see <ulink
        url="http://aws.amazon.com">http://aws.amazon.com</ulink>.</para>

        <para>You can use the <literal>ami-80e950e9</literal> image as a
        starting point.</para>
      </listitem>

      <listitem>
        <para>AWS provides a configuration wizard for creating your image. You
        should be able to accept most of the defaults. Some parameters to
        note:<itemizedlist>
            <listitem>
              <para>For the <emphasis role="bold">Availability
              Zone</emphasis>, we recommend that you choose
              <literal>us-east-1a</literal>.</para>
            </listitem>

            <listitem>
              <para>You should create a key pair if you do not already have
              one.</para>
            </listitem>

            <listitem>
              <para>You should create a security group that uses SSH.</para>
            </listitem>
          </itemizedlist></para>
      </listitem>

      <listitem>
        <para>Start your AMI and connect to it. On the details page for your
        AMI, not the URL. For example, if your image URL is e,
        ec2-23-20-246-232.compute-1.amazonaws.com, you could issue the
        following command in a terminal:<programlisting>ssh -i ~/.ssh/myKeyFile.pem -o StrictHostKeyChecking=no ubuntu@ec2-23-20-246-232.compute-1.amazonaws.com</programlisting></para>
      </listitem>

      <listitem>
        <para>Execute the following commands to initialize local
        storage:</para>

        <programlisting>./osinit.sh
./pginit.sh</programlisting>
      </listitem>

      <listitem>
        <para>Execute the following command to get the latest SciDB
        repository:</para>

        <programlisting>sudo apt-get update</programlisting>
      </listitem>

      <listitem>
        <para>Login as user scidb (password scidb123) and execute the
        following script to initialize and start SciDB.</para>

        <programlisting>./dbinit.sh</programlisting>
      </listitem>
    </orderedlist>

    <para>Your SciDB installation is now ready to use. As user 'scidb', you
    can now load data, run queries and use your SciDB installation.</para>

    <programlisting>
scidb@ip-10-191-93-50:~$ iquery -aq "list('instances')"

No,name,port,instance_id,online_since,instance_path
0,"127.0.0.1",1239,0,"2012-09-12 18:52:28","/mnt/xldb/000/0"
1,"127.0.0.1",1240,1,"2012-09-12 18:52:28","/mnt/xldb/000/1"</programlisting>
  </section>
</chapter>
